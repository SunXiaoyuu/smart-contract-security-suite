<mat-card>
  <h2>ğŸ§© æ™ºèƒ½åˆçº¦æ¼æ´æ£€æµ‹æ¨¡å—</h2>

  <mat-form-field appearance="outline" class="w-full">
    <textarea
      matInput
      placeholder="ç²˜è´´æ™ºèƒ½åˆçº¦ä»£ç ..."
      [(ngModel)]="code"
      rows="6">
    </textarea>
    <button 
      mat-icon-button 
      matSuffix 
      (click)="copyCode()" 
      [disabled]="!code"
      matTooltip="å¤åˆ¶ä»£ç ">
      <mat-icon>content_copy</mat-icon>
    </button>
  </mat-form-field>

  <div class="button-group">
    <button mat-raised-button color="accent" (click)="detect()" [disabled]="isDetecting || !code">
      {{ isDetecting ? 'æ£€æµ‹ä¸­...' : 'å¼€å§‹æ£€æµ‹' }}
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      (click)="generateReport()" 
      [disabled]="!report || isGeneratingReport"
      style="margin-left: 10px;">
      {{ isGeneratingReport ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆæ£€æµ‹æŠ¥å‘Š' }}
    </button>

    <button 
      mat-raised-button 
      color="warn" 
      (click)="goToRepair()" 
      [disabled]="!report"
      style="margin-left: 10px;">
      ä¸‹ä¸€æ­¥ï¼šæ¼æ´ä¿®è¡¥ â†’
    </button>

    <button 
      mat-raised-button 
      color="warn" 
      (click)="goToTestchain()" 
      [disabled]="!report"
      style="margin-left: 10px;">
      åˆçº¦å®Œæˆï¼Œå‰å¾€æµ‹è¯•ç½‘
    </button>
  </div>

  <!-- æ£€æµ‹ç»“æœ -->
  <div *ngIf="report && !fullReport" style="margin-top: 20px;">
    <h3>æ£€æµ‹ç»“æœï¼š</h3>
    <mat-list>
      <mat-list-item *ngFor="let v of report.vulnerabilities">
        <div mat-line>
          <b>{{ v.type }}</b> - ä¸¥é‡ç­‰çº§: 
          <span [style.color]="getSeverityColor(v.severity)">{{ v.severity }}</span>
        </div>
        <div mat-line style="font-size: 12px; color: #666;">
          è¡Œå·: {{ v.line }} | å»ºè®®: {{ v.suggestion }}
        </div>
      </mat-list-item>
    </mat-list>
  </div>

  <!-- å®Œæ•´æŠ¥å‘Š -->
  <div *ngIf="fullReport" style="margin-top: 20px;">
    <mat-card class="report-card">
      <mat-card-header>
        <mat-card-title>
          <h3>ğŸ“Š æ¼æ´æ£€æµ‹å®Œæ•´æŠ¥å‘Š</h3>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="report-content" [innerHTML]="fullReport"></div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button (click)="downloadReport()">ä¸‹è½½æŠ¥å‘Š</button>
        <button mat-button (click)="closeReport()">å…³é—­</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- é”™è¯¯æç¤º -->
  <div *ngIf="errorMessage" style="margin-top: 20px; color: red;">
    <mat-error>{{ errorMessage }}</mat-error>
  </div>
</mat-card>